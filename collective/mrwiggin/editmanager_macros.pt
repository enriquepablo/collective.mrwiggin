
<div metal:define-macro="rendered-portlets" i18n:domain="plone">
    <tal:block repeat="portlet view/portlets">
        <tal:block replace="structure python:view.safe_render(portlet['renderer'])" />
    </tal:block>
</div>

<div metal:define-macro="portlet-add-form" class="section" i18n:domain="plone">


    <div class="buttons">
        <div class="button_add"
             i18n:translate="label_add_portlet">Add portlet</div>
        <div class="button_close"
             i18n:translate="label_button_close">Close</div>
        <ul>
            <li tal:repeat="portlet view/addable_portlets">
                <a tal:attributes="href string:${view/context_url}${portlet/addview}?referer=${view/referer}"
                   tal:content="portlet/title">Portlet</a>
            </li>
        </ul>
    </div>

</div>

<div metal:define-macro="current-portlets-list" class="portletAssignments"
    i18n:domain="plone">

    <h4 i18n:translate="heading_portlets_assigned_here">
        Portlets assigned here
    </h4>

    <div tal:attributes="class string:kssattr-viewname-${view/__parent__/__name__}">
        <tal:block repeat="portlet view/portlets">
            <div tal:define="hiddenPortletClass python:not portlet['visible'] and 'blockedPortlet' or ''"
                 tal:attributes="class string:managedPortlet portlet kssattr-portlethash-${portlet/hash} ${hiddenPortletClass}">
                <div class="portletHeader">
                    <span class="managedPortletActions">
                    <a href="#" class="up"
                       title="Move up"
                       i18n:attributes="title"
                       tal:condition="not:repeat/portlet/start"
                       tal:attributes="href string:${portlet/up_url}&amp;referer=${view/url_quote_referer}">&uarr;</a>
                    <a href="#" class="down"
                       title="Move down"
                       i18n:attributes="title"
                       tal:condition="not:repeat/portlet/end"
                       tal:attributes="href string:${portlet/down_url}&amp;referer=${view/url_quote_referer}">&darr;</a>
                    <a href="#" class="toggle-visibility"
                       tal:condition="not: portlet/visible"
                       i18n:translate="label_show_item"
                       tal:attributes="href string:${portlet/show_url}&amp;referer=${view/url_quote_referer}">Show</a>
                    <a href="#" class="toggle-visibility"
                       tal:condition="portlet/visible"
                       i18n:translate="label_hide_item"
                       tal:attributes="href string:${portlet/hide_url}&amp;referer=${view/url_quote_referer}">Hide</a>
                    <a href="#" class="delete"
                       title="Remove"
                       i18n:attributes="title"
                       tal:attributes="href string:${portlet/delete_url}&amp;referer=${view/url_quote_referer}">&times;</a>
                    </span>
                    <a tal:omit-tag="not:portlet/editview"
                       tal:attributes="href string:${portlet/editview}?referer=${view/url_quote_referer}"
                       tal:content="portlet/title" />
                </div>
            </div>
        </tal:block>
    </div>

</div>

<div metal:define-macro="blocking-portlets" class="portletAssignments"
     i18n:domain="plone">

    <h4 i18n:translate="heading_un_block_portlets">
        Block/unblock portlets
    </h4>

    <form method="post" tal:attributes="action view/blacklist_status_action">

      <input type="hidden" name="manager" tal:attributes="value view/manager_name" />

      <div tal:define="status view/context_blacklist_status">

        <span tal:omit-tag=""
              i18n:translate="label_portlets_parent_folders">
            Parent portlets:
        </span>

        <input type="radio" name="context_status:int" value="1"
               tal:attributes="checked python:status == True and 'checked' or None">
        <label i18n:translate="portlets_value_block">Block</label>
        <input type="radio" name="context_status:int" value="-1"
               tal:attributes="checked python:(status == False or status == None) and 'checked' or None">
        <label i18n:translate="portlets_value_show">Do not block</label>


        <tal:block define="portlets view/inherited_portlets;"
                   condition="portlets">

          <div tal:attributes="class python:status and 'managedPortlet inheritedPortlet blockedPortlet' or 'managedPortlet'" tal:repeat="portlet portlets">
            <div class="portletHeader">

              <a tal:omit-tag="not:portlet/editview"
                tal:attributes="href string:${portlet/editview}/?referer=${view/url_quote_referer}"
                tal:content="portlet/title" />

              <span class="portletBlockedMessage hiddenStructure"
                tal:condition="status"
                title="Blocked"
                i18n:translate="label_portlet_blocked"
                i18n:attributes="title title_portlet_blocked;">
                (Blocked)
              </span>

            </div>
          </div>
        </tal:block>

      </div>

      <div tal:define="status view/group_blacklist_status">

        <span tal:omit-tag=""
              i18n:translate="label_portlets_group_portlets">Group portlets:</span>

        <input type="radio" name="group_status:int" value="1"
               tal:attributes="checked python:status == True and 'checked' or None">
        <label i18n:translate="portlets_value_block">Block</label>
        <input type="radio" name="group_status:int" value="-1"
               tal:attributes="checked python:status == False and 'checked' or None">
        <label i18n:translate="portlets_value_show">Do not block</label>
        <input type="radio" name="group_status:int" value="0"
               tal:attributes="checked python:status == None and 'checked' or None">
        <label i18n:translate="portlets_value_use_parent">Use parent settings</label>

        <tal:block define="portlets view/group_portlets;
                           status python:view.group_blacklist_status(check_parent=True)">

          <div tal:attributes="class python:status and 'managedPortlet inheritedPortlet blockedPortlet' or 'managedPortlet'" tal:repeat="portlet portlets">
            <div class="portletHeader">

              <a tal:omit-tag="not:portlet/editview"
                tal:attributes="href string:${portlet/editview}/?referer=${view/url_quote_referer}"
                tal:content="portlet/title" />

              <span class="portletBlockedMessage hiddenStructure"
                tal:condition="status"
                title="Blocked"
                i18n:translate="label_portlet_blocked"
                i18n:attributes="title title_portlet_blocked;">
                (Blocked)
              </span>

            </div>
          </div>

        </tal:block>

      </div>


      <div tal:define="status view/content_type_blacklist_status">

        <span tal:omit-tag=""
              i18n:translate="label_portlets_content_type_portlets">
            Content type portlets:
        </span>

        <input type="radio" name="content_type_status:int" value="1"
               tal:attributes="checked python:status == True and 'checked' or None">
        <label i18n:translate="portlets_value_block">Block</label>
        <input type="radio" name="content_type_status:int" value="-1"
               tal:attributes="checked python:status == False and 'checked' or None">
        <label i18n:translate="portlets_value_show">Do not block</label>
        <input type="radio" name="content_type_status:int" value="0"
               tal:attributes="checked python:status == None and 'checked' or None">
        <label i18n:translate="portlets_value_use_parent">Use parent settings</label>

        <tal:block define="portlets view/content_type_portlets;
                   status python:view.content_type_blacklist_status(check_parent=True)">

          <div tal:attributes="class python:status and 'managedPortlet inheritedPortlet blockedPortlet' or 'managedPortlet'"
            tal:repeat="portlet portlets">
            <div class="portletHeader">
              <a tal:omit-tag="not:portlet/editview"
                tal:attributes="href string:${portlet/editview}/?referer=${view/url_quote_referer}"
                tal:content="portlet/title" />

              <span class="portletBlockedMessage hiddenStructure"
                tal:condition="status"
                title="Blocked"
                i18n:translate="label_portlet_blocked"
                i18n:attributes="title title_portlet_blocked;">
                (Blocked)
              </span>

            </div>
          </div>
        </tal:block>

      </div>


      <div class="formControls">
          <input class="context"
                 type="submit"
                 value="Save settings"
                 i18n:attributes="value label_save_settings"/>
      </div>

    </form>
  </div>
